---
title: ทำไมเราต้องคำนึงถึง Scalability
layout: post
---
Application ต่างๆ ที่สร้างขึ้นมาย่อมต้องการที่จะเติบโตและดำรงอยู่กับผู้ใช้ไปนานๆ สำหรับ Online Application ไม่ว่าจะสร้างขึ้นมาเพื่อองค์กรหรือว่าผู้ใช้รายบุคคลย่อมเจอปัญหาที่ว่า เมื่อระบบโตขึ้นเรื่อยๆ ระบบจะต้องจัดการกับข้อมูลที่มีขนาดใหญ่ขึ้นกว่าเดิมมาก และจำนวนผู้ใช้งานพร้อมกันมากขึ้นเรื่อยๆ ทำให้ระบบจะต้องขยายความสามารถของระบบเพื่อรองรับการเปลี่ยนแปลงเหล่านี้ แล้วมักจะมีคำถามว่า เราจะขยายระบบของเราอย่างไรเพื่อให้การลงทุนทั้งแรงและเงินที่เราลงทุนลงไปนั้นคุ้มค่า

## Vertical Scale VS Horizontal Scale
เมื่อระบบทำงานช้า ไม่สามารถรองรับผู้ใช้งานหรือข้อมูลที่เพิ่มขึ้นได้ สิ่งแรกที่เราทำกันเพื่อให้ได้ผลเร็วที่สุดคือ อัพสเปค Server กันสิครับ ใช้ตังค์ถมเข้าไป อัดแรม อัพเกรดซีพียู เพิ่มฮาร์ดดิสก์ ก็ว่ากันไปตามแต่ปัญหาที่เกิดขึ้น วิธีการนี้เรียกว่า Vertical Scale หรือการเพิ่มความสามารถของ Hardware โดยไม่ได้เพิ่มจำนวนของ Node ที่ให้บริการ การขยายระบบในรูปแบบนี้รวดเร็ว ง่าย เห็นผลเร็ว มีตังค์เป็นพอ

พอเราทำไปเรื่อยๆ เราจะถึงจุดที่ว่าใช้ตังค์แล้วไม่คุ้มกันเลย เช่น RAM128GB ราคาอยู่ที่ 18,000 บาท (ตอนที่หนังสือเล่มที่อ้างอิงเขียน) แต่ถ้าต้องอัพเป็น 256GB ราคาจะโดดไปเป็น 540,000 บาท เฮ้ย แม่เจ้า จะซื้อจริงหรอ? อันนี้ตัวอย่างน้ำจิ้มๆ เพราะของบางอย่างเงินก็ซื้อไม่ได้สินะ เช่น เราต้องการระบบที่อ่านข้อมูลในดิสก์ได้เร็วขึ้น ตอนนี้ก็ใช้ SSD แล้ว นี่เราจะต้องรอเทคโนโลยีที่ล้ำกว่า SSD ณ ชาติไหน ผู้ใช้ระบบเราจะรอเทคโนโลยีนั้นได้หรอ หรือว่าถ้าผู้ใช้งานกระจายอยู่ทุกๆ ซอกหลืบของโลกใบนี้ แค่เงินมาอัพระบบเราคงไม่พอแล้วสินะ

วิธีการอีกรูปแบบหนึ่งในการขยายระบบคือ การขยายออกแนวกว้าง (Horizontal Scale) หรือการที่เพิ่มจำนวน Node ที่ให้บริการแทนการอัพสเปคที่อาจจะไม่คุ้มอีกต่อไป วิธีการนี้สามารถแบ่งออกเป็น 2 แนวทางใหญ่ๆ คือ สร้าง Node ที่เหมือนๆ กันขึ้นมาให้ทำงานพร้อมกัน เช่น Sharding DB, Web Service ที่ Run บนหลายๆ Server เป็นต้น หรือหั่นระบบให้เล็กลงแล้วแยกออกไป เช่น แยกเครื่อง DB/Web Service/Front End, หั่น Service เป็น MicroService เล็กๆ แล้วแยกเครื่องกันไป (จริงๆ ยังมีวิธีการยิบย่อยเพื่อแก้ปัญหาอีก เช่น Caching แต่ว่าจะแก้ปัญหาเฉพาะเจาะจงมากขึ้น) แต่การได้มาซึ่งระบบที่ scale แบบนี้ได้จำเป็นต้องมีการวางแผนและออกแบบที่ดี เพราะเป็นการเพิ่มความซับซ้อนให้กับระบบมากขึ้น และมีปัญหา Synchronization ระหว่าง Node ที่ต้องจัดการเพื่อให้สามารถแยก Node ออกจากกันได้

## สิ่งที่ต้องคำนึงสำหรับการออกแบบเพื่อ Scalability

* **คุณภาพของ code ที่เขียนขึ้น** คือส่วนที่สำคัญที่สุดและเป็นรากฐานของทุกระบบไม่ว่าระบบจะต้องการการ Scale หรือไม่ เพราะถ้า code มีความซับซ้อนเกินความจำเป็น แก้ยาก อ่านไม่เข้าใจ การปรับปรุงเพื่อรองรับ Architect หรือเทคโนโลยีใหม่อาจจะเป็นไปได้ยาก และอีกส่วนที่สำคัญคือ Document และ Test ที่ควรได้รับการดูแลเท่าเทียมกับ source code เพราะไม่เช่นนั้นเราจะไม่สามารถรู้ได้เลยว่าระบบทั้งหมดทำงานอย่างไร (เว้นแต่มันเล็กมาก Devจำได้ถูกต้องทั้งหมด และอย่ามีใครลาออกเชียว) และไม่มีสิ่งใดยืนยันได้ว่าระบบที่ปรับปรุงขึ้นนั้นสามารถทำงานได้เหมือนกับก่อนที่จะแก้ไข

* **สถาปัตยกรรมของระบบ** ในการ Scale ย่อมีการออกแบบสถาปัตยกรรมของซอฟต์แวร์แตกต่างออกไปจากระบบที่ทำงานอยู่เพียง Node เดียว เช่น Stateless Service, Synchronization, Sharding เป็นต้น เพื่อรองรับระบบย่อยที่แยกออกมา หรือทำงานไปพร้อมๆ กัน ดังนั้นการ Scale ระบบจำเป็นต้องเข้าใจถึงพฤติกรรมที่เกิดขึ้น และออกแบบเพื่อจัดการกับความซับซ้อนที่เพิ่มขึ้นให้ถูกจุด (และไม่ได้เพิ่มความซับซ้อนมากขึ้นไปอีก)

* **เทคโนโลยี** ปัจจุบันมีเทคโนโลยีให้เลือกใช้สำหรับแก้ไปปัญหามากมาย แต่การนำเทคโนโลยีเข้ามาใช้เหมือนเป็นดาบสองคม เพราะหลายๆ เทคโนโลยีในปัจจุบันถูกสร้างมาเพื่อแก้ปัญหาเฉพาะตัวมากขึ้น และบางทีก็แถมฟังก์ชั่นเสริมเล็กๆ น้อยๆ มาให้ไขว้เขวจากจุดประสงค์หลักที่แท้จริง ดังนั้นหากนำมาใช้อย่างไม่ตรงกับปัญหาที่เรามีแล้ว อาจจะกลายเป็นการเผาป่าเพื่อล่าแมลงสาปซักตัว ที่เราลงเงินลงแรงมากเกินความจำเป็นกับปัญหาอันน้อยนิดกระจิดริดของเรา ที่มีวิธีการง่ายๆ สร้างความซับซ้อนน้อยกว่าในการจัดการปัญหา อีกทั้งการนำเทคโนโลยีมาใช้มากขึ้น ทำให้เราจำเป็นต้องมี`ความรู้` ในการดูแลเทคโนโลยีเหล่านี้ด้วย ไม่เช่นนั้นพอเกิดปัญหาขึ้นมา เทคโนโลยีเหล่านี้จะกลับมาเผาผลาญตัวระบบเสียเอง สุดท้้ายเสียทั้งป่า แมลงสาปที่ตามหาก็อาจจะเป็นจุลไปด้วย

Blog นี้พวกเราเขียนขึ้นด้วยความตั้งใจที่จะแชร์ความรู้ เทคนิค และประสบการณ์ (ที่ดีและเลวร้าย) ของพวกเราในทั้ง 3 ด้าน เพื่อแสดงให้เห็นว่าการ Scale ไม่ได้น่ากลัว (Scary) อย่างที่คิด ถ้าเราเข้าใจพื้นฐานและความต้องการของระบบที่เราสร้างขึ้น
