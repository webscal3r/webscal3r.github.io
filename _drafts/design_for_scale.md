---
title: เทคนิคการออกแบบเพื่อการ Scale
layout: post
---
ในการขยายระบบออกไปในแนวกว้าง (Horizontal Scale) นั้น มีหลากหลายวิธีด้วยกัน ซึ่งแต่ละวิธีนั้นก็มีข้อดีและความลำบากในการที่ได้ระบบแบบนั้นมาแตกต่างกัน ซึ่งวิธีทั้งหลายที่มีอยู่เราสามารถจำแนกได้ออกเป็น 3 เทคนิค คือ

1. **โคลนนิ่งระบบ** แล้วให้ระบบทำงานทำงานพร้อมกันหลายๆ Node เพื่อรองรับจำนวนผู้ใช้ที่มากขึ้น
2. **Function Partitioning** การแบ่งระบบตามลักษณะการทำงาน
3. **Data Partitioning** การแบ่งข้อมูลออกเป็นชุดย่อยๆ แล้วเก็บไว้ที่คนละเครื่องกัน

## โคลนนิ่งระบบ
การโคลนนิ่งระบบ (Add more clones) คือการเอา Infrastructure ที่เหมือนกันกับระบบที่มีอยู่เดิมเด๊ะๆ มาอีกชุดนึง แล้วก็ deploy service ขึ้นไปทำงานพร้อมๆ กัน วิธีการนี้ดูเหมือนง่ายนะ เร็วด้วย ใช้ตังค์ถมได้ แต่ทั้งนี้ระบบที่ clone ขึ้นมาจะถูกออกแบบมาให้ทำงานในลักษณะไร้สถานะ (Stateless service) หรือสามารถ sync สถานะร่วมกันได้ไม่ยาก เพื่อที่ว่าระบบที่ถูกโคลนนิ่งมานั้นสามารถเพิ่มเข้าไปทำงานได้อย่างอิสระ โดยที่ผู้ใช้หรือระบบที่เรียกใช้งานสามารถเรียกเซิรฟเวอร์ไหนก็ได้  (แถมพังได้อย่างอิสระอีกด้วย คิดว่าเป็นข้อดีนะ)

## Function Partitioning
เป็นการแบ่งระบบตามลักษณะการทำงานของแต่ละส่วน ซึ่งวิธีการนี้สามารถนำไปประยุกต์ใช้ได้ในหลายระดับ (Level of Abstraction) เช่น ในระดับล่างสุดที่เป็นระดับของ Infrastructure จะแบ่งตามประเภทของ Server ออกไป เช่น แยกเครื่องสำหรับ Database, Web Server, Message Queue เป็นต้น แต่การแบ่งระดับนี้ค่อนข้างหยาบไป ทำให้แบ่งได้ไม่มาก พอถึงจุดหนึ่งอาจจะจำเป็นต้องแบ่งลึกลงไปอีกในระบบ Service ระบบที่สร้างขึ้นให้ทำงานด้วยกันเป็นระบบเดียวหรือที่เรียกว่า Monolith Service อาจจะต้องถูกหั่นให้แยกออกจากกันตามฟังก์ชั่นการทำงาน

วิธีการนี้มีข้อดีขึ้นเราสามารถ craft ระบบในระดับที่ล่างกว่าเพื่อตามความต้องการเฉพาะตัวในแต่ละระบบได้ เช่น ระบบ e-commerce เราสามารถแบ่งออกเป็น ส่วนการดูสินค้า (Product Catalogue) และส่วนของการสั่งซื้อ (Ordering System) ซึ่งสองส่วนนี้มีการใ่ช้งานข้อมูลที่ต่างกันอย่างเห็นได้ชัดคือ ส่วนที่ดูสินค้าจะเน้นการอ่านข้อมูลที่ซับซ้อน ซึ่งอาจจะไปถึงขึ้น Full Text Search เลยก็ได้ แต่ว่าการเขียนหรือแก้ไขข้อมูลนั้นน้อยมากเมื่อเทียบกับระบบการสั่งซื้อ ดังนั้นสามารถที่จะใช้ Infrastructure และเทคโนโลยีที่ต่างกันได้ตามรูปแบบการทำงานที่แตกต่างกัน

แต่การแบ่งระบบแบบนี้ต้องแลกมาด้วยการสื่อสารระหว่างระบบที่มากขึ้น แถมยังต้องแก้โค้ด ตั้ง Infra ใหม่ แล้วถ้าระบบออกแบบมาไม่ดีพอที่จะให้แยกออกจากกันง่ายๆ แล้ว การเลือกเทคนิคนี้เหมือนการเขียนระบบใหม่ดีๆ นี่เอง และเมื่อระบบที่ดำเนินต่อไปเรื่อยๆ เราไม่สามารถที่จะลงทุนสร้างใหม่ได้ตลอดเวลา ดังนั้นเทคนิคนี้จะต้องมีการวางแผนไว้ล่วงหน้าบ้าง และจำต้องรักษาคุณภาพโค้ดให้เพียงพอที่จะเข้าไปแก้ไขครั้งใหญ่ได้ด้วยนะ

## Data Partitioning
เป็นการแบ่งโดยข้อมูลที่มี แบ่งออกเป็นส่วนย่อยๆ ที่อิสระต่อกัน แล้วเก็บไว้คนละเครื่องกัน เช่น การทำ Database Sharding เป็นต้น ซึ่งข้อจำกัดการทำระบบแบบนี้คล้ายๆ กับการทำโคลนนิ่งที่แต่ละ Node จะต้องไม่แชร์อะไรต่อกัน ไม่เช่นนั้นค่าใช้จ่ายในการ Sync กันจะสูงจนไม่สามารถเพิ่ม Node ใหม่เข้าไปได้

เทคนิคทั้ง 3 อย่างที่นำเสนอขึ้นมา ไม่ได้ถูกแยกจากกันเพื่อให้เลือกอย่างใดอย่างหนึ่ง แต่แยกเพื่อความเข้าใจ และทำให้สามารถนำไปผสมผสานกันออกมาเป็นสูตรที่เหมาะสมกับสถานการณ์ แต่ละวิธีมีประโยชน์ที่ได้และค่าใช้จ่ายที่จ่ายออกไปในรูปแบบที่แตกต่างกัน ดังนั้นในการเลือกใช้จะต้องคำนึงถึงสภาพแวดล้อมและจังหวะเวลาที่เหมาะสมด้วย

การวางแผน ออกแบบเพื่อการขยายระบบนั้นเป็นศิลปะอย่างหนึ่ง ที่ไม่มีสูตรตายตัวว่าควรจะเตรียมตัวไว้เยอะแค่ไหน จังหวะไหนที่ควรจะขยายออกด้วยวิธีการอะไรบ้าง เพราะแต่ละวิธีนำมาซึ่งความซับซ้อนเพิ่มขึ้นในระบบ ดังนั้นการออกแบบระบบจะต้องชั่งน้ำหนัก ระหว่างความรวดเร็วในการพัฒนาเพื่อเอาระบบขึ้นไปในช่วงแรกกับการขยายระบบออกไปในอนาคต  การวางแผนมากเกินไปก็เป็นภาระไม่แพ้กับการไม่วางแผนเลยเช่นกัน

##อ้างอิง
* Artur Ejsmont 2015, _Web Scalability for Startup Engineers_.
